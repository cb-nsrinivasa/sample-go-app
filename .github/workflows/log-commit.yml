name: Build Go Project

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      MY_NAME: "this-secret"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: 1.21  # Change this to your Go version

      - name: Install dependencies
        run: go mod tidy

      - name: Build the project
        run: go build -v ./...

      - name: Run tests
        run: go test -v ./...
        
      - name: mark-secret
        run: echo "::add-mask::$MY_NAME"
      - name: log-secret
        run: echo "We retrieved our masked secret $MY_NAME"
        
      - name: Print GitHub Context Variables
        run: echo '${{ toJson(github) }}'
        
      - name: log-secret-string
        run: echo "We retrieved our masked secret this-secret"
      - name: Set new value
        run: echo "MY_NAME=UpdatedValue" >> $GITHUB_ENV
      - name: log-changed-secret
        run: echo "We retrieved our masked secret $MY_NAME"
      - name: from-gh-secret
        run: echo "We retrieved secret from gh secret ${{ secrets.SECRET }}"
      - name: substring-gh-secret
        run: echo "${{ secrets.SECRET }}" | awk '{print substr($0, 0, 5)}'
      - name: substring-redacted-string
        run: echo "$MY_NAME" | awk '{print substr($0, 0, 5)}'
      - name: wrong secret
        run: echo "We retrieved secret from gh secret ${{ secrets.MY_SECRE }}"

      - name: chained-command
        run: echo -n "::add-mask::$(date +"%Y%m%d")" && echo "$(date +"%Y%m%d")"
        
      # - name: dynamic-var
      #   run: echo "::add-mask::$(date +"%Y%m%d")"
        
      - name: dynamic-var-without-mask
        run: echo "$(date +"%Y%m%d")"

